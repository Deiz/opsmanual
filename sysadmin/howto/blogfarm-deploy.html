

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>HOWTO: Deploy changes to the blogfarm &mdash; OKF Operations Manual</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../../',
        VERSION:'1.0',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="OKF Operations Manual" href="../../index.html"/>
        <link rel="up" title="Step-by-step HOWTOs for common problems" href="index.html"/>
        <link rel="next" title="HOWTO: “Dead man’s switch” monitoring" href="deadmanssnitch.html"/>
        <link rel="prev" title="HOWTO: Administering APT" href="administering-apt.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="icon icon-home"> OKF Operations Manual</a>
        <form class="wy-form" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../guides/index.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../guides/email-aliases/index.html">Email alias management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guides/mailing-lists/index.html">Managing mailing lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guides/managing-a-blogfarm-site/index.html">Managing a site in the Blogfarm</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Sysadmin pages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#who-are-we">Who are we?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#how-to-get-help">How to get help</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#documentation-and-notes">Documentation and notes</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../opsmanual-getting-started.html">Getting started with the Ops Manual, reStructuredText, and Sphinx</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../opsmanual-getting-started.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../opsmanual-getting-started.html#ops-manual-structure">Ops Manual Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../opsmanual-getting-started.html#restructuredtext">reStructuredText</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../opsmanual-getting-started.html#the-build">The Build</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">OKF Operations Manual</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../../index.html">Docs</a> &raquo;</li>
  <li><a href="">HOWTO: Deploy changes to the blogfarm</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="howto-deploy-changes-to-the-blogfarm">
<h1>HOWTO: Deploy changes to the blogfarm<a class="headerlink" href="#howto-deploy-changes-to-the-blogfarm" title="Permalink to this headline">¶</a></h1>
<p>This article describes how to deploy code to OKFN&#8217;s Wordpress blogfarm
at WPEngine.</p>
<div class="section" id="general">
<h2>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<p>Some basic instructions outlining the code deployment procedures for our
blog farm hoster WPE (WPEngine - <a class="reference external" href="http://wpengine.com/">http://wpengine.com/</a>).</p>
<p>WPE code deployment is done through their git post-recieve hook. In
essence it&#8217;s as simply as commiting code changes to the repository and
doing a git push back to the WPE remote. More detailed instructions can
be found in their documentation about this - <a class="reference external" href="http://git.wpengine.com/">http://git.wpengine.com/</a>.</p>
<p>Access to the WPE git repos is controlled by public keys. You&#8217;ll need to
contact the OKF Sysadmin team to have your public key granted access
before proceeding. Once this has been done, confirm access by:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ssh git@git.wpengine.com info
</pre></div>
</div>
<p>You should get a response back listing the repositories you have access
to. At a minimum these should be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">production</span><span class="o">/</span><span class="n">okf</span>
<span class="n">staging</span><span class="o">/</span><span class="n">okf</span>
</pre></div>
</div>
<p>Consider these as two separate git remotes containing the code for the
production web dir and staging web dir respectively. For now, disregard
the staging remote as we don&#8217;t have anything setup there.</p>
<p>The first thing you want to do is sync with the production remote,
depending on how you have your local code setup you can add this remote
to an existing repo, or create a new working directory and run the
following:</p>
<div class="highlight-python"><div class="highlight"><pre>$ git clone git@git.wpengine.com:production/okf.git wordpress
$ cd wordpress
</pre></div>
</div>
<p>This repository uses submodules for the various plugins and themes. So
before doing anything else you should initialize and update these:</p>
<div class="highlight-python"><div class="highlight"><pre>$ git submodule init
$ git submodule update
</pre></div>
</div>
<p>Deploying changes is as simple as pushing your commits back to the
production remote. So something like the following. It&#8217;s advised that
you do this via a terminal window so that you can see descriptive
deployment progress output, along with any custom errors:</p>
<div class="highlight-python"><div class="highlight"><pre>$ git push origin master
</pre></div>
</div>
<p>Or run git remote -v to list the remotes of your local repo. If you
cloned from the production repo then that is most like the &#8220;origin&#8221;
remote.</p>
<p>As always, be sure to retrieve changes made by other users before
pushing back to WPE:</p>
<div class="highlight-python"><div class="highlight"><pre>$ git pull --rebase
</pre></div>
</div>
</div>
<div class="section" id="sub-modules">
<h2>Sub Modules<a class="headerlink" href="#sub-modules" title="Permalink to this headline">¶</a></h2>
<p>Note that submodules are referenced to a master repository via commit
ID&#8217;s, rather than branches. As such, changes to submodules need to be
committed to the master repo as well. That is, if you commit a change to
a submodule, the latest commit for that repository has progressed, and
that new status needs to be reflected in the master repo. If you make
changes to the submodule outside of the main repo working directory,
you&#8217;ll need to git pull that submodule into the main working dir and
commit it&#8217;s new pointer to that main repo.</p>
<p>When you deploy to WPE, for any submodule that the master repository
knows about, the commit for that submodule must be accessible to WPE.
This means 2 things: 1) The repo must be publicly readable. WPE does not
provide a public key for you to grant access to private repos. 2) The
commit to retrieve must be available on that remote (pushed)</p>
<p>The latter is often forgotten. Use the following one liner to push all
submodules from your master repo root dir:</p>
<div class="highlight-python"><div class="highlight"><pre>$ git submodule foreach git push master origin
</pre></div>
</div>
<p>It&#8217;s typically easier to work on all files (main repo and submodules)
within the same working directory so that you can commit to both the sub
and main repos quickly.</p>
<p>If other users make changes to the sub-modules, you&#8217;ll need to retrieve
these to your own local dir also. So before making any changes, it&#8217;s
good practice to do the following:</p>
<div class="highlight-python"><div class="highlight"><pre>$ git pull origin master
$ git submodule foreach git pull origin master
</pre></div>
</div>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="deadmanssnitch.html" class="btn btn-neutral float-right" title="HOWTO: “Dead man’s switch” monitoring"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="administering-apt.html" class="btn btn-neutral" title="HOWTO: Administering APT"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2013, Open Knowledge Foundation.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>