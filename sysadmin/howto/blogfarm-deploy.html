
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    

    <title>HOWTO: Deploy changes to the blogfarm &mdash; OKF Operations Manual</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>


    
    <link rel="stylesheet" href="../../_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/searchtools.js"></script>
    <link rel="top" title="OKF Operations Manual" href="../../index.html" />
    <link rel="up" title="Step-by-step HOWTOs for common problems" href="index.html" />
    <link rel="next" title="HOWTO: Debian packaging" href="debian-packaging.html" />
    <link rel="prev" title="HOWTO: Administering APT" href="administering-apt.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="debian-packaging.html" title="HOWTO: Debian packaging"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="administering-apt.html" title="HOWTO: Administering APT"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">OKF Operations Manual</a> &raquo;</li>
          <li><a href="../index.html" >Sysadmin pages</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Step-by-step HOWTOs for common problems</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="howto-deploy-changes-to-the-blogfarm">
<h1>HOWTO: Deploy changes to the blogfarm<a class="headerlink" href="#howto-deploy-changes-to-the-blogfarm" title="Permalink to this headline">¶</a></h1>
<p>This article describes how to deploy code to OKFN&#8217;s Wordpress blogfarm
at WPEngine.</p>
<div class="section" id="general">
<h2>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<p>Some basic instructions outlining the code deployment procedures for our
blog farm hoster WPE (WPEngine - <a class="reference external" href="http://wpengine.com/">http://wpengine.com/</a>).</p>
<p>WPE code deployment is done through their git post-recieve hook. In
essence it&#8217;s as simply as commiting code changes to the repository and
doing a git push back to the WPE remote. More detailed instructions can
be found in their documentation about this - <a class="reference external" href="http://git.wpengine.com/">http://git.wpengine.com/</a>.</p>
<p>Access to the WPE git repos is controlled by public keys. You&#8217;ll need to
contact the OKF Sysadmin team to have your public key granted access
before proceeding. Once this has been done, confirm access by:</p>
<div class="highlight-python"><pre>$ ssh git@git.wpengine.com info</pre>
</div>
<p>You should get a response back listing the repositories you have access
to. At a minimum these should be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">production</span><span class="o">/</span><span class="n">okf</span>
<span class="n">staging</span><span class="o">/</span><span class="n">okf</span>
</pre></div>
</div>
<p>Consider these as two separate git remotes containing the code for the
production web dir and staging web dir respectively. For now, disregard
the staging remote as we don&#8217;t have anything setup there.</p>
<p>The first thing you want to do is sync with the production remote,
depending on how you have your local code setup you can add this remote
to an existing repo, or create a new working directory and run the
following:</p>
<div class="highlight-python"><pre>$ git clone git@git.wpengine.com:production/okf.git wordpress
$ cd wordpress</pre>
</div>
<p>This repository uses submodules for the various plugins and themes. So
before doing anything else you should initialize and update these:</p>
<div class="highlight-python"><pre>$ git submodule init
$ git submodule update</pre>
</div>
<p>Deploying changes is as simple as pushing your commits back to the
production remote. So something like the following. It&#8217;s advised that
you do this via a terminal window so that you can see descriptive
deployment progress output, along with any custom errors:</p>
<div class="highlight-python"><pre>$ git push origin master</pre>
</div>
<p>Or run git remote -v to list the remotes of your local repo. If you
cloned from the production repo then that is most like the &#8220;origin&#8221;
remote.</p>
<p>As always, be sure to retrieve changes made by other users before
pushing back to WPE:</p>
<div class="highlight-python"><pre>$ git pull --rebase</pre>
</div>
</div>
<div class="section" id="sub-modules">
<h2>Sub Modules<a class="headerlink" href="#sub-modules" title="Permalink to this headline">¶</a></h2>
<p>Note that submodules are referenced to a master repository via commit
ID&#8217;s, rather than branches. As such, changes to submodules need to be
committed to the master repo as well. That is, if you commit a change to
a submodule, the latest commit for that repository has progressed, and
that new status needs to be reflected in the master repo. If you make
changes to the submodule outside of the main repo working directory,
you&#8217;ll need to git pull that submodule into the main working dir and
commit it&#8217;s new pointer to that main repo.</p>
<p>When you deploy to WPE, for any submodule that the master repository
knows about, the commit for that submodule must be accessible to WPE.
This means 2 things: 1) The repo must be publicly readable. WPE does not
provide a public key for you to grant access to private repos. 2) The
commit to retrieve must be available on that remote (pushed)</p>
<p>The latter is often forgotten. Use the following one liner to push all
submodules from your master repo root dir:</p>
<div class="highlight-python"><pre>$ git submodule foreach git push master origin</pre>
</div>
<p>It&#8217;s typically easier to work on all files (main repo and submodules)
within the same working directory so that you can commit to both the sub
and main repos quickly.</p>
<p>If other users make changes to the sub-modules, you&#8217;ll need to retrieve
these to your own local dir also. So before making any changes, it&#8217;s
good practice to do the following:</p>
<div class="highlight-python"><pre>$ git pull origin master
$ git submodule foreach git pull origin master</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HOWTO: Deploy changes to the blogfarm</a><ul>
<li><a class="reference internal" href="#general">General</a></li>
<li><a class="reference internal" href="#sub-modules">Sub Modules</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="administering-apt.html"
                        title="previous chapter">HOWTO: Administering APT</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="debian-packaging.html"
                        title="next chapter">HOWTO: Debian packaging</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/sysadmin/howto/blogfarm-deploy.txt"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/okfn/opsmanual/edit/master/sysadmin/howto/blogfarm-deploy.rst"
           rel="nofollow">Edit on GitHub</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="debian-packaging.html" title="HOWTO: Debian packaging"
             >next</a> |</li>
        <li class="right" >
          <a href="administering-apt.html" title="HOWTO: Administering APT"
             >previous</a> |</li>
        <li><a href="../../index.html">OKF Operations Manual</a> &raquo;</li>
          <li><a href="../index.html" >Sysadmin pages</a> &raquo;</li>
          <li><a href="index.html" >Step-by-step HOWTOs for common problems</a> &raquo;</li> 
      </ul>
    </div>
<div class="footer">
    &copy; Copyright 2013, Open Knowledge Foundation.
  Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
  <br />Theme based on <a href="http://readthedocs.org/">Read The Docs</a>

</div>





  </body>
</html>